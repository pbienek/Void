function speedLimit(t,e){return Math.abs(t)>e&&(t=t>0?e:0-e),t}function outOfBounds(t,e){return t>this.screenW||0>t||e>this.screenH||0>e}function getDistance(t,e,i,s){var a,n=0;return a=t-i,a*=a,n=e-s,n*=n,Math.sqrt(a+n)}function normalize(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function truncate(t,e){var i=e/2;return i=1>i?1:i,{x:t.x*i,y:t.y*i}}function getRandomNum(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomNumFloat(t,e){return Math.random()*(e-t)+t}function getStationByID(t){for(var e=0;e<$.Universe.locations.length;e++)if($.Universe.locations[e].id===t)return $.Universe.locations[e]}function findCloseObjects(t,e,i){var s=[],a=[];s=$.Universe.ships.concat($.Universe.locations,$.Universe.objects);for(var n=s.length;n--;){var r=getDistance(t,e,s[n].x,s[n].y);i>=r&&a.push(s[n])}return a}function checkSpacing(t,e,i,s){for(var a=0,n=i.length;n--;){var r=getDistance(t,e,i[n].x,i[n].y);s>r&&a++}return!a}function fps(){}function warezListGenerator(){return[{name:"Food",price:getRandomNum(40,60),description:"Simple organic products",volume:1},{name:"Textiles",price:getRandomNum(60,80),description:"Unprocessed fabrics",volume:1},{name:"Radioactives",price:getRandomNum(200,280),description:"Ores and by-products",volume:1},{name:"Slaves",price:getRandomNum(80,110),description:"Usually humanoid",volume:1},{name:"Liquor/Wines",price:getRandomNum(250,320),description:"Exotic spirits from unearthy flora",volume:1},{name:"Luxuries",price:getRandomNum(800,1100),description:"Perfumes, Spices, Coffee",volume:1},{name:"Narcotics",price:getRandomNum(1100,1400),description:"Tobacco, Arcturan Megaweed",volume:1}]}Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};var intersectionCheck=function(t,e){var i={x:t.x,y:t.y},s={x:t.x+t.width,y:t.y+t.height},a={x:e.x,y:e.y},n={x:e.x+e.width,y:e.y+e.width};return!(s.y<a.y||i.y>n.y||s.x<a.x||i.x>n.x)};$.KM=function(){},$.KM.prototype={up:null,down:null,left:null,right:null,mousePos:0},$.KM.init=function(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.mousePos={},this.mouseDown=!1,this.leftMouseDown=!1,this.rightMouseDown=!1,this.map={},window.addEventListener("keydown",this.getKey,!1),window.addEventListener("keyup",this.getKey,!1),window.addEventListener("keypress",function(t){112==t.charCode&&($.paused?($.UI.closeMessage(),$.paused=!1):($.paused=!0,$.UI.showMessage("GAME PAUSED")))},!1),window.addEventListener("mousemove",this.getMousePos,!1),window.oncontextmenu=function(){return!1},window.addEventListener("mousedown",function(t){this.mouseDown=!0,1===t.which&&(this.leftMouseDown=!0),3===t.which&&(t.preventDefault(),this.rightMouseDown=!0)}.bind(this),!1),window.addEventListener("mouseup",function(t){this.mouseDown=!1,1===t.which&&(this.leftMouseDown=!1),3===t.which&&(t.preventDefault(),this.rightMouseDown=!1)}.bind(this),!1),document.getElementById("game-container").addEventListener("mousemove",function(t){this.mousePos={x:t.offsetX||t.layerX,y:t.offsetY||t.layerY}}.bind(this))},$.KM.getKey=function(t){var e=t.keyCode;(87===e||83===e||65===e||68===e||32===e||70==e||80==e)&&($.KM.map[e]="keydown"==t.type)},$.Projectiles=function(){},$.Projectiles.init=function(){this.canvas=$.projectilesCanvas,this.bullets=[]},$.Projectiles.add=function(t,e,i,s,a,n,r){var o={width:a,height:n,x:e.x,y:e.y,origin:e,angle:t,speed:i,vel:{x:e.velX,y:e.velY},colour:s,hp:r,owner:"player",rotation:t,spawnTime:$.gameTime};this.bullets.push(o)},$.Projectiles.process=function(t,e){t.x+=t.speed*Math.cos(t.angle)+t.vel.x,t.y+=t.speed*Math.sin(t.angle)+t.vel.y,this.drawX=$.Universe.offsetX+t.x,this.drawY=$.Universe.offsetY+t.y,$.gameTime-t.spawnTime>50?this.deleteMe(e):(this.hitCheck(t,e),this.draw(this.drawX,this.drawY,t.colour,t.width,t.height,t.rotation))},$.Projectiles.deleteMe=function(t){this.bullets.splice(t,1)},$.Projectiles.hitCheck=function(t,e){for(var i=$.Universe.ships.length;i--;){var s={width:$.Universe.ships[i].width,height:$.Universe.ships[i].height,x:$.Universe.ships[i].x,y:$.Universe.ships[i].y};t.origin.faction!==$.Universe.ships[i].faction&&intersectionCheck(t,s)&&$.Universe.ships[i].faction!==t.origin.faction&&($.Universe.ships[i].hit(t.hp),this.deleteMe(e))}"player"!==t.origin.faction&&intersectionCheck(t,$.Player)&&($.Player.hit(t.hp,t.origin.id),this.deleteMe(e))},$.Projectiles.casualUpdate=function(){},$.Projectiles.update=function(){for(var t=this.bullets.length;t--;)this.process(this.bullets[t],t)},$.Projectiles.draw=function(t,e,i,s,a,n){var r=this.canvas.createLinearGradient(0,0,s,0);r.addColorStop(0,"rgba("+i+",0)"),r.addColorStop(1,"rgba("+i+",1)"),this.canvas.save(),this.canvas.translate(t,e),this.canvas.rotate(n),this.canvas.beginPath(),this.canvas.rect(0,0,s,a),this.canvas.fillStyle=r,this.canvas.fill(),this.canvas.rotate(-1),this.canvas.translate(-1*t,-1*e),this.canvas.restore()},$.ParticleEmiter=function(){},$.ParticleEmiter.prototype={init:function(t,e,i,s){this.id=Math.floor(1e6*Math.random()),this.canvas=$.projectilesCanvas,this.type=i,this.origin={x:t,y:e,ship:s||null},this.startTime=$.gameTime,this.particles=[],"thrust"===i&&this.generateThrust(),"explosion"===i&&this.generateExplosion(),"shield"===i&&this.generateShield()},generateExplosion:function(){this.duration=100,this.volume=80;for(var t=360/this.volume*(180/Math.PI),e=0;e<this.volume;e++){Math.floor(10*Math.random())+2,Math.round(Math.random()*$.screenW+1),Math.round(Math.random()*$.screenH+1);t+=getRandomNumFloat(-.2,.2),this.particles.push({started:!1,x:this.origin.x,y:this.origin.y,vel:{x:0,y:0},acceleration:.2,friction:.01,opacity:1,width:getRandomNum(10,90),height:1,colour:"rgba(255,255,255,1)",colourCode:"255,255,255",angle:t*e,rotation:t*e,ship:this.origin.ship,age:1})}setTimeout(function(){for(var t=$.particleInstances.length;t--;)$.particleInstances[t].id===this.id&&$.particleInstances.splice(t,1);delete this}.bind(this),100*this.duration)},updateExplosionParticle:function(t){var e=t.angle,i=t.acceleration*(t.width/8);t.width=t.width,t.opacity=t.opacity-t.age++/8e3,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.vel.x=i*Math.cos(e),t.vel.y=i*Math.sin(e),t.x+=t.vel.x,t.y+=t.vel.y},drawExplosionParticle:function(t){var e=$.Universe.offsetX+t.x,i=$.Universe.offsetY+t.y;this.canvas.save(),this.canvas.translate(e,i),this.canvas.rotate(t.rotation),this.canvas.beginPath(),this.canvas.rect(0,0,t.width,t.height),this.canvas.fillStyle=t.colour,this.canvas.fill(),this.canvas.rotate(-1*t.rotation),this.canvas.translate(-1*e,-1*i),this.canvas.restore()},generateThrust:function(){this.duration=3,this.volume=1;for(var t,e,i=0,s=0;s<this.volume;s++)t=Math.floor(10*Math.random())+2,e=Math.round(Math.random()*$.screenW+1),i=Math.round(Math.random()*$.screenH+1),this.particles.push({started:!1,x:this.origin.x-=this.origin.ship.width/2*Math.cos(this.origin.ship.rotation),y:this.origin.y-=this.origin.ship.width/2*Math.sin(this.origin.ship.rotation),vel:{x:0,y:0},acceleration:.2,friction:.01,opacity:1,size:t,colour:"rgba(79, 253, 138,1)",colourCode:"79, 253, 138",angle:getRandomNumFloat(this.origin.ship.rotation-.5,this.origin.ship.rotation+.5),dest:{x:e,y:i},rotation:Math.atan2(getRandomNumFloat(0,3),getRandomNumFloat(0,3)),ship:this.origin.ship,age:1});setTimeout(function(){for(var t=$.particleInstances.length;t--;)$.particleInstances[t].id===this.id&&$.particleInstances.splice(t,1);delete this}.bind(this),100*this.duration)},updateThrustParticle:function(t){var e=t.angle,i=t.acceleration*(t.size/4);t.size=1*t.age,t.opacity=t.opacity-t.age++/600,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.vel.x=i*Math.cos(e),t.vel.y=i*Math.sin(e),t.x+=t.vel.x,t.y+=t.vel.y},drawThrustParticle:function(t){var e=$.Universe.offsetX+t.x,i=$.Universe.offsetY+t.y;this.canvas.save(),this.canvas.translate(e,i),this.canvas.rotate(t.rotation),this.canvas.beginPath(),this.canvas.arc(0,0,t.size/2,0,2*Math.PI,!1),this.canvas.fillStyle=t.colour,this.canvas.fill(),this.canvas.rotate(-1*t.rotation),this.canvas.translate(-1*e,-1*i),this.canvas.restore()},generateShield:function(){this.duration=3,this.volume=1;this.particles.push({started:!1,x:this.origin.x,y:this.origin.y,opacity:.2,size:this.origin.ship.width,colour:"rgba(93, 215, 255,0.15)",colourCode:"93, 215, 255",ship:this.origin.ship,age:1}),setTimeout(function(){for(var t=$.particleInstances.length;t--;)$.particleInstances[t].id===this.id&&$.particleInstances.splice(t,1);delete this}.bind(this),500*this.duration)},updateShieldParticle:function(t){t.opacity=t.opacity-.01,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.x=t.ship.x,t.y=t.ship.y},drawShieldParticle:function(t){var e=$.Universe.offsetX+t.x,i=$.Universe.offsetY+t.y;this.canvas.save(),this.canvas.translate(e,i),this.canvas.beginPath(),this.canvas.arc(0,0,t.size,0,2*Math.PI,!1),this.canvas.fillStyle=t.colour,this.canvas.fill(),this.canvas.translate(-1*e,-1*i),this.canvas.restore()},update:function(){if("thrust"===this.type)for(var t=this.particles.length;t--;)this.updateThrustParticle(this.particles[t]),this.drawThrustParticle(this.particles[t]);if("explosion"===this.type)for(var t=this.particles.length;t--;)this.updateExplosionParticle(this.particles[t]),this.drawExplosionParticle(this.particles[t]);if("shield"===this.type)for(var t=this.particles.length;t--;)this.updateShieldParticle(this.particles[t]),this.drawShieldParticle(this.particles[t])}},$.Player=function(){},$.Player.init=function(){this.id="PLAYER",this.canvas=$.playerCanvas,this.x=$.Universe.width/2,this.y=$.Universe.width/2,this.center={x:0,y:0},this.radius=40,this.width=60,this.height=30,this.shipSVG=playerShip,this.rotation=0,this.velocity={x:0,y:0},this.topSpeed=7,this.friction=0,this.acceleration=.04,this.touching=!1,this.cargoBay={},this.hull={capacity:200,total:200},this.shield={capacity:200,total:200,regenerationRate:.1},this.fuel={capacity:200,total:200},this.laser={coolDown:5,hp:20,speed:8,width:40,height:2,colour:"223, 88, 235"},this.lastShot=0,this.closestStation={},this.dockingRange=!1,this.docked=!1,this.dead=!1,this.credits=1e3,this.faction="player",this.closeObjects=[],this.radarRadius=4e3},$.Player.movement=function(){function t(){var t=$.KM.mousePos.x-$.screenW/2,e=$.KM.mousePos.y-$.screenH/2,i=Math.atan2(e,t);return i}this.keyboardControls(),$.KM.leftMouseDown&&this.fuel.total>0&&!this.dead&&(this.velocity.x+=this.acceleration*Math.cos(this.rotation),this.velocity.y+=this.acceleration*Math.sin(this.rotation),this.fuel.total-=.1,this.thrustEffect()),this.velocity.x=speedLimit(this.velocity.x,this.topSpeed),this.velocity.y=speedLimit(this.velocity.y,this.topSpeed),this.collisionDetection(),this.x+=this.velocity.x,this.y+=this.velocity.y,this.rotation=t()},$.Player.collisionDetection=function(){for(var t=!1,e=this.closeObjects.length;e--;){var i=getDistance(this.x,this.y,this.closeObjects[e].x,this.closeObjects[e].y);i<=this.radius+this.closeObjects[e].radius&&(this.touching||(this.velocity.x*=-.5,this.velocity.y*=-.5),this.touching=!0,t=!0)}this.touching=t},$.Player.keyboardControls=function(){$.KM.map[70]&&this.dockingRange&&this.dock()},$.Player.thrustEffect=function(){var t=new $.ParticleEmiter;t.init(this.x,this.y,"thrust",this),$.particleInstances.push(t)},$.Player.casualUpdate=function(){this.docked||($.KM.rightMouseDown&&this.fireWeapon(),this.dockingCheck(),this.closeObjects=findCloseObjects(this.x,this.y,1e3)),this.shield.total<this.shield.capacity&&(this.shield.total+=this.shield.regenerationRate)},$.Player.dockingCheck=function(){for(var t=500,e=!0,i=$.Universe.locations.length;i--&&e;){var s=getDistance(this.x,this.y,$.Universe.locations[i].x,$.Universe.locations[i].y);t>=s?(this.closestStation=$.Universe.locations[i],this.dockingRange=!0,e=!1,$.UI.showMessage('<span class="title">'+$.Universe.locations[i].name+'</span><br /> Press "F" to dock with this Space Station.')):($.UI.messageIsOpen&&$.UI.closeMessage(),this.dockingRange=!1)}},$.Player.dock=function(){this.docked=!0,this.velocity.x=0,this.velocity.Y=0,this.fuel.total=Math.round(this.fuel.total),this.fuel.hull=Math.round(this.hull.total),this.closestStation.dockedShips++,$.UI.showStationMenu(this.closestStation)},$.Player.undock=function(){this.docked=!1,this.closestStation.dockedShips--,this.cleanInventory()},$.Player.cleanInventory=function(){for(var t in this.cargoBay)this.cargoBay[t].qnt<=0&&delete this.cargoBay[t]},$.Player.fireWeapon=function(){var t=Math.atan2($.KM.mousePos.y-$.screenH/2,$.KM.mousePos.x-$.screenW/2),e=(Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y)+this.laser.speed,{x:this.x,y:this.y});e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.velocity.x,velY:this.velocity.y,faction:this.faction,id:this.id},$.gameTime>this.lastShot+this.laser.coolDown&&($.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime)},$.Player.hit=function(t){if(!this.docked){if(this.shield.total>0){this.shield.total-=t;var e=new $.ParticleEmiter;e.init(this.x,this.y,"shield",this),$.particleInstances.push(e)}else if(this.hull.total-=t,this.hull.total<=0){var e=new $.ParticleEmiter;e.init(this.x,this.y,"explosion",this),$.particleInstances.push(e),this.velocity.x=0,this.velocity.y=0,this.dead=!0}$.UI.hit()}},$.shieldHit=function(){},$.Player.update=function(){this.docked||this.movement(),this.draw()},$.Player.draw=function(){if(!this.dead){this.canvas.save(),this.canvas.translate($.screenW/2,$.screenH/2),this.canvas.rotate(this.rotation);for(var t in this.shipSVG)this.canvas.fillStyle=this.shipSVG[t].colour,this.canvas.fill(this.shipSVG[t].shape);this.canvas.restore()}},$.Location=function(){},$.Location.prototype={init:function(t,e){this.id=Math.floor(1e6*Math.random()),this.name="TERRAN STATION",this.canvas=$.objectsCanvas,this.x=t,this.y=e,this.radius=200,this.size=this.radius,this.center={x:this.x+this.size,y:this.y+this.size},this.type="station",this.drawX=0,this.drawY=0,this.rotation=0,this.discovered=!1,this.shipSVG=station,this.velocity={x:0,y:0},this.stock=this.stockInventory(),this.lastStockUpdate=0,this.stockUpdateFrequency=600,this.dockedShips=0,this.services={fuel:{cost:.3},hull:{cost:1}},this.credits=1e4,this.fuzzShipsCount=0,this.tradeShipsCount=0},spawnShips:function(){if(0===this.fuzzShipsCount){var t=new $.FuzzShip;t.init(this),$.Universe.ships.push(t),this.fuzzShipsCount++}if(0===this.tradeShipsCount){var e=new $.TradingShip;e.init(this),$.Universe.ships.push(e),this.tradeShipsCount++}},stockInventory:function(){function t(t){a.hasOwnProperty(t.name)?a[t.name].qnt++:a[t.name]={price:t.price,rrp:t.price,qnt:1,description:t.description}}for(var e=1e5,i=warezListGenerator(),s=i.length-1,a={},n=1e7,r=0;r<i.length;r++)i[r].price<n&&(n=i[r].price);for(;e>=n;){var o=getRandomNum(0,s);i[o].price<=e&&(t(i[o]),e-=i[o].price)}return a},updateStockPrices:function(){if($.gameTime>=this.lastStockUpdate+this.stockUpdateFrequency&&0===this.dockedShips){for(var t in this.stock){var e=this.stock[t].rrp/1e3,i=50-this.stock[t].qnt;this.stock[t].price=this.stock[t].rrp+Math.round(e*i)}this.lastStockUpdate=$.gameTime}},buyItem:function(t,e){if(e.cargoBay.hasOwnProperty(t)){e.cargoBay[t].qnt++,e.cargoBay[t].paidValues.push(this.stock[t].price),e.cargoBay[t].netValue=0;for(var i=0;i<e.cargoBay[t].paidValues.length;i++)e.cargoBay[t].netValue+=e.cargoBay[t].paidValues[i];e.cargoBay[t].avgPrice=e.cargoBay[t].netValue/e.cargoBay[t].qnt||0}else e.cargoBay[t]={paidValues:[this.stock[t].price],netValue:this.stock[t].price,avgPrice:this.stock[t].price,name:t,qnt:1,description:this.stock[t].description};e.credits-=this.stock[t].price,this.stock[t].qnt--},sellItem:function(t,e){this.stock[t].qnt++,e.credits+=this.stock[t].price,this.stock[t].qnt++,e.cargoBay[t].qnt--,e.cargoBay[t].paidValues.pop(),e.cargoBay[t].netValue=0;for(var i=0;i<e.cargoBay[t].paidValues.length;i++)e.cargoBay[t].netValue+=e.cargoBay[t].paidValues[i];e.cargoBay[t].avgPrice=e.cargoBay[t].netValue/e.cargoBay[t].qnt||0},buyService:function(t,e,i){e[t].total+=parseInt(i),e.credits-=this.services[t].cost*i,this.credits+=this.services[t].cost*i},casualUpdate:function(){this.updateStockPrices(),this.spawnShips()},update:function(){this.drawX=$.Universe.offsetX+this.x,this.drawY=$.Universe.offsetY+this.y,this.rotation+=.002,this.draw()},draw:function(){this.canvas.save(),this.canvas.translate(this.drawX,this.drawY),this.canvas.rotate(this.rotation);for(var t in this.shipSVG)this.canvas.fillStyle=this.shipSVG[t].colour,this.canvas.fill(this.shipSVG[t].shape);this.canvas.rotate(-1*this.rotation),this.canvas.translate(-1*this.drawX,-1*this.drawY),this.canvas.restore()}};var playerShip={main:{shape:new Path2D("M 10,-15 -25,-15 -30,-11 -30,-5 -25,-5 -25,0 -25,5 -30,5 -30,11 -25,15 10,15 30,5 30,0 30,0 30,-5"),colour:"#fff"},shadow1:{shape:new Path2D("M 10.1,-15 -25,-15 -30,-11 -30,-11 4,-11"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M 10.1,15 -25,15 -30,11 -30,11 4,11"),colour:"#CFCFCF"}},pirateShip={main:{shape:new Path2D("M 29.8,0 9,-10 11,-15 0,-11 -11,-20 -2.2,-29.9 -30,-24.6 -21,-15 -26,0 -21,15.1 -30,24.7 -2.2,30 -11,20.1 0,11.1 11,15.1 9,10.1 	"),colour:"#fff"},shadow1:{shape:new Path2D("M -30,-24.6 -21,-15 0,-11 -11,-20"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M 0,-11 9,-10 11,-15"),colour:"#CFCFCF"},shadow3:{shape:new Path2D("M -30,24.7 -11,20.1 0,11.1 -21,15.1"),colour:"#CFCFCF"},shadow4:{shape:new Path2D("M 9,10.1 0,11.1 11,15.1"),colour:"#CFCFCF"}},cargoShip={main:{shape:new Path2D("M 50,-30 25,-30 25,-25 20,-25 20,-30 15,-30 15,-25 10,-25 10,-30 5,-30 5,-25 0,-25 0,-30 -5,-30 -5,-25 -10,-25 -10,-30 -15,-30 -15,-25 -20,-25 -20,-30 -25.1,-30 -25,-25 -30,-25 -30,-30 -50,-30 -60,-20 -60,-10 -50,-10 -50,0 -50,10 -60,10 -60,20 -50,30 -30,30 -30,25 -25,25 -25.1,30 -20,30 -20,25 -15,25 -15,30 -10,30 -10,25 -5,25 -5,30 0,30 0,25 5,25 5,30 10,30 10,25 15,25 15,30 20,30 20,25 25,25 25,30 50,30 60,7 60,0 60,-7"),colour:"#fff"}},fuzzShip={main:{shape:new Path2D("M 30,5 30,0 30,-5 0,-30 -30,-20 -30,-10 -25,-10 -25,0 -25,10 -30,10 -30,20 0,30"),colour:"#fff"},shadow1:{shape:new Path2D("M -25,-10 -25,10 0,0 30,-5 30,5 0,0"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M -30,-20 -30,-10 -25,-10 -0,-30"),colour:"#CFCFCF"},shadow3:{shape:new Path2D("M -30,20 -30,10 -25,10 -0,30"),colour:"#CFCFCF"}},station={main:{shape:new Path2D("M -200,0.3 -139,-140 0,-199 139,-140 200,0.3 139,139 0,200 -141,139"),colour:"#CFCFCF"},shadow1:{shape:new Path2D("M -200,0.3 0,-199 200,0.3 0.4,200"),colour:"#fff"},shadow2:{shape:new Path2D("M -69,-21 -69,20 0,20 70,20 70,-21 4,-21"),colour:"#CFCFCF"}};$.Ship=function(){},$.Ship.prototype={init:function(t){this.id=Math.floor(1e6*Math.random()),this.canvas=$.shipsCanvas,this.x=Math.floor(Math.random()*$.Universe.width)+1||0,this.y=Math.floor(Math.random()*$.Universe.height)+1||0,this.velocity={x:0,y:0},this.topSpeed=0,this.friction=0,this.acceleration=0,this.mass=50,this.desiredRotation=0,this.rotation=0,this.home=t,this.potentialThreats=[],this.lastHit=0,this.targetDestination={x:0,y:0,velocity:{x:0,y:0},distance:0,stoppingDistance:250},this.fleeTarget={x:0,y:0,velocity:{x:0,y:0},distance:0,stoppingDistance:250},this.hitList={},this.hull={capacity:1e3,total:1e3},this.shield={capacity:200,total:200,regenerationRate:.1},this.fuel={capacity:1e3,total:1e3},this.station={},this.dockingRange=!1,this.docked=!1,this.finishedTrade=!1,this.timeDocked=0,this.dockDuration=50,this.bounty=0,this.mode="seek",this.firedAtBy="",this.closeObjects=[],this.create()},movement:function(){var t={},e={x:0,y:0},i=function(e){var i={x:e.x-this.x,y:e.y-this.y};i=normalize(i),e.distance=getDistance(this.x,this.y,e.x,e.y)-e.stoppingDistance;var s=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),a=s/this.acceleration*s*.5;a>=e.distance?(t={x:i.x*(this.topSpeed*(e.distance/a)),y:i.y*(this.topSpeed*(e.distance/a))},this.targetDestination.distance<=1&&(t={x:0,y:0})):t={x:i.x*this.topSpeed,y:i.y*this.topSpeed}}.bind(this),s=function(e){var i={x:this.x-e.x,y:this.y-e.y};i=normalize(i),t={x:i.x*this.topSpeed,y:i.y*this.topSpeed}}.bind(this),a=function(){var t=100,e=10,i={x:this.velocity.x,y:this.velocity.y},s=normalize(i),a={x:this.velocity.x,y:this.velocity.y};a=normalize(a),a={x:a.x*(.5*t*2/this.topSpeed),y:a.y*(.5*t*2/this.topSpeed)};var n=(this.velocity.x+this.velocity.y)/this.topSpeed,r={x:this.x+s.x*n,y:this.y+s.y*n},o=function(e){var i={x:this.x+s.x*t*.5,y:this.y+s.y*t*.5};return getDistance(e.x,e.y,r.x,r.y)<=e.size||getDistance(e.x,e.y,i.x,i.y)<=e.size||getDistance(e.x,e.y,this.x,this.y)<=e.size}.bind(this),h=function(){for(var t=null,e=$.Universe.locations.concat($.Universe.ships),i=0;i<e.length;i++){var s=e[i],a=o(s);a&&(null==t||getDistance(this.x,this.y,s.x,s.y)<getDistance(this.x,this.y,t.x,t.y))&&(t=s)}return t}.bind(this),c=h(),l={x:0,y:0};return null!=c?(l.x=r.x-c.center.x,l.y=r.y-c.center.y,l=normalize(l),l={x:l.x*e,y:l.y*e}):l={x:0,y:0},isNaN(l.x)&&isNaN(l.y)?{x:0,y:0}:l}.bind(this),n=function(){for(var t={x:0,y:0},e=80,i=0,s=5,a=0;a<this.closeObjects.length;a++){var n=this.closeObjects[a];n.id!=this.id&&getDistance(n.x,n.y,this.x,this.y)<=e&&(t.x+=n.x-this.x,t.y+=n.y-this.y,i++)}return 0!=i&&(t.x/=i,t.y/=i,t.x*=-1,t.y*=-1,t=normalize(t),t.x*=s,t.y*=s),t}.bind(this);"seek"===this.mode&&i(this.targetDestination),"flee"===this.mode&&s(this.targetDestination),"pursuit"===this.mode&&i(this.targetDestination),"evade"===this.mode&&evade(this.targetDestination);var r=a(),o=n();e={x:t.x-this.velocity.x+r.x+o.x,y:t.y-this.velocity.y+r.y+o.y},0!==e.x&&0!==e.y&&(e=truncate(e,this.acceleration),e.x=e.x/this.mass,e.y=e.y/this.mass);var h={x:this.velocity.x+e.x,y:this.velocity.y+e.y};if(h=truncate(h,this.acceleration),this.velocity.x=h.x,this.velocity.y=h.y,!this.docked){this.x+=this.velocity.x,this.y+=this.velocity.y;var c=function(){var t=this.targetDestination.x-this.x,e=this.targetDestination.y-this.y,i=Math.atan2(e,t);return i}.bind(this);this.rotation=c()}},combatMode:function(){this.potentialThreats.length>0?(this.fleeTarget.x=this.potentialThreats[0].x,this.fleeTarget.y=this.potentialThreats[0].y,this.fleeTarget.velocity.x=this.potentialThreats[0].velocity.x,this.fleeTarget.velocity.y=this.potentialThreats[0].velocity.y,this.mode="flee"):(this.mode="seek",this.targetDestination.x=this.potentialTargets[0].x,this.targetDestination.y=this.potentialTargets[0].y,this.targetDestination.velocity.x=this.potentialTargets[0].velocity.x,this.targetDestination.velocity.y=this.potentialTargets[0].velocity.y,this.targetDestination.distance<=this.fireRange&&this.fireAtTarget())},hit:function(t,e){if(!this.docked){this.shield.total>0?this.shield.total-=t:this.hull.total-=t;var i=new $.ParticleEmiter;i.init(this.x,this.y,"shield",this),$.particleInstances.push(i),this.hitList[e]++,this.firedAtBy=e,this.lastHit=$.gameTime}this.hull.total<=0&&this.die()},die:function(){for(var t=$.Universe.ships.length;t--;)$.Universe.ships[t].id===this.id&&$.Universe.ships.splice(t,1);"police"===this.type&&this.home.fuzzShipsCount--,"cargo ship"===this.type&&this.home.tradeShipsCount--,"pirate"===this.type&&$.Universe.pirateShipCount--;var e=new $.ParticleEmiter;e.init(this.x,this.y,"explosion",this),$.particleInstances.push(e),delete this},update:function(){this.drawX=$.Universe.offsetX+this.x,this.drawY=$.Universe.offsetY+this.y,this.movement(),this.draw()},casualUpdate:function(){this.ai(),this.shield.total<this.shield.capacity&&!this.dead&&(this.shield.total+=this.shield.regenerationRate)},draw:function(){if(!this.atHome){this.canvas.save(),this.canvas.translate(this.drawX,this.drawY),this.canvas.rotate(this.rotation);for(var t in this.shipSVG)this.canvas.fillStyle=this.shipSVG[t].colour,this.canvas.fill(this.shipSVG[t].shape);this.canvas.rotate(-1*this.rotation),this.canvas.translate(-1*this.drawX,-1*this.drawY),this.canvas.restore()}}},$.PirateShip=function(){$.Ship.call(this)},$.PirateShip.prototype=new $.Ship,$.PirateShip.prototype.constructor=$.PirateShip,$.PirateShip.prototype.create=function(){this.shipSVG=pirateShip,this.width=60,this.height=60,this.currentTarget=null,this.potentialTargets=[],this.targetRange=2e3,this.fireRange=800,this.lastShot=0,this.laser={coolDown:3,hp:10,speed:8,width:40,height:2,colour:"233,36,67"},this.topSpeed=11,this.acceleration=.05,this.faction="outlaw",this.type="pirate",this.bounty=40},$.PirateShip.prototype.ai=function(){this.closeObjects=findCloseObjects(this.x,this.y,2e3),getDistance(this.x,this.y,$.Player.x,$.Player.y)<=2e3&&this.closeObjects.push($.Player),this.potentialTargets=[],this.potentialThreats=[];for(var t=this.closeObjects.length;t--;){var e=this.closeObjects[t];$.gameTime>this.lastHit+5&&!e.docked&&!e.dead&&"station"!==e.type&&"outlaw"!==e.faction&&(this.potentialTargets.push({id:e.id,x:e.x,y:e.y,velocity:{x:e.velocity.x,y:e.velocity.y},faction:e.faction,priority:this.priority(e)}),"police"===e.type&&this.potentialThreats.push({id:e.id,x:e.x,y:e.y,velocity:{x:e.velocity.x,y:e.velocity.y},faction:e.faction,priority:this.priority(e)}))}this.potentialTargets.sort(function(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}),this.potentialTargets.length>0?this.combatMode():(this.mode="seek",(this.targetDestination.distance<200||0===this.targetDestination.x&&0===this.targetDestination.y)&&(this.targetDestination.x=getRandomNum(0,$.Universe.width),this.targetDestination.y=getRandomNum(0,$.Universe.height),this.targetDestination.velocity.x=0,this.targetDestination.velocity.y=0))},$.PirateShip.prototype.priority=function(t){var e=0;return this.hitList[t.id]&&(e+=this.hitList[t.id]),e},$.PirateShip.prototype.fireAtTarget=function(){if($.gameTime>this.lastShot+this.laser.coolDown){var t=Math.atan2(this.potentialTargets[0].y-this.y,this.potentialTargets[0].x-this.x),e={x:this.x,y:this.y};e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.velocity.x,velY:this.velocity.y,faction:this.faction},$.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime}},$.TradingShip=function(){$.Ship.call(this)},$.TradingShip.prototype=new $.Ship,$.TradingShip.prototype.constructor=$.TradingShip,$.TradingShip.prototype.create=function(){this.shipSVG=cargoShip,this.width=120,this.height=60,this.radius=80,this.targetRange=2e3,this.topSpeed=5,this.acceleration=.05,this.faction="tradeAlliance",this.type="cargo ship",this.stationList=[],this.credits=1e3,this.cargoSpace=20,this.cargoBay={},this.x=this.home.x+400,this.y=this.home.y+400},$.TradingShip.prototype.ai=function(){var t=function(){if(0===this.stationList.length){for(var t in $.Universe.locations)$.Universe.locations[t].id!==this.station.id&&this.stationList.push({id:$.Universe.locations[t].id,x:$.Universe.locations[t].x,y:$.Universe.locations[t].y});this.stationList.sort(function(t,e){var i=getDistance(this.x,this.y,t.x,t.y),s=getDistance(this.x,this.y,e.x,e.y);return i>s?1:-1}.bind(this)),this.targetDestination.x=this.stationList[0].x,this.targetDestination.y=this.stationList[0].y,this.targetDestination.velocity.x=0,this.targetDestination.velocity.y=0}}.bind(this);t(),this.targetDestination.distance<200&&this.targetDestination.distance>0&&!this.docked&&(this.dockingRange=!0,this.docked=!0,this.station=getStationByID(this.stationList[0].id),this.timeDocked=$.gameTime,this.station.dockedShips++),this.docked&&(this.finishedTrade?$.gameTime>=this.timeDocked+this.dockDuration&&(this.stationList.splice(0,1),t(),this.targetDestination.x=this.stationList[0].x,this.targetDestination.y=this.stationList[0].y,this.targetDestination.velocity.x=0,this.targetDestination.velocity.y=0,this.docked=!1,this.finishedTrade=!1,this.station.dockedShips--):this.tradeGoods())},$.TradingShip.prototype.tradeGoods=function(){var t=[];for(var e in this.cargoBay)if(this.cargoBay[e].avgPrice<this.station.stock[e].price){for(var i=0;i<this.cargoBay[e].qnt;i++)this.station.sellItem(e,this);t.push(e)}var s=[];for(var e in this.station.stock)-1===t.indexOf(e)&&s.push(e);for(var a=1e7,n=0;n<s.length;n++)this.station.stock[s[n]].price<a&&(a=this.station.stock[s[n]].price);for(;this.credits>=a;){var e=getRandomNum(0,s.length-1);if(!(this.station.stock[s[e]].qnt>0))break;this.station.stock[s[e]].price<=this.credits&&this.station.buyItem(s[e],this)}this.finishedTrade=!0},$.FuzzShip=function(){$.Ship.call(this)},$.FuzzShip.prototype=new $.Ship,$.FuzzShip.prototype.constructor=$.FuzzShip,$.FuzzShip.prototype.create=function(){this.shipSVG=fuzzShip,this.width=60,this.height=60,this.currentTarget=null,this.potentialTargets=[],this.targetRange=2e3,this.fireRange=800,this.lastShot=0,this.laser={coolDown:2,hp:20,speed:11,width:40,height:2,colour:"36,213,243"},this.topSpeed=9,this.acceleration=.05,this.faction="tradeAlliance",this.type="police",this.x=this.home.x,this.y=this.home.y,this.atHome=!1},$.FuzzShip.prototype.ai=function(){this.closeObjects=findCloseObjects(this.home.x,this.home.y,2e3),getDistance(this.home.x,this.home.y,$.Player.x,$.Player.y)<=2e3&&this.closeObjects.push($.Player),this.potentialTargets=[];for(var t=this.closeObjects.length;t--;){var e=this.closeObjects[t];e.faction!==this.faction&&e.bounty>0&&this.potentialTargets.push({id:e.id,x:e.x,y:e.y,velocity:{x:e.velocity.x,y:e.velocity.y},faction:e.faction,priority:this.priority})}this.potentialTargets.sort(function(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}),this.potentialTargets.length>0?this.attackMode():(this.mode="seek",this.targetDestination.x=this.home.x+250,this.targetDestination.y=this.home.y+250,this.targetDestination.velocity.x=0,this.targetDestination.velocity.y=0)},$.FuzzShip.prototype.priority=function(t){var e=0;return"pirate"===t.faction&&(e+=10),this.hitList[t.id]&&(e+=this.hitList[t.id]),e},$.FuzzShip.prototype.attackMode=function(){this.atHome=!1,this.combatMode()},$.FuzzShip.prototype.fireAtTarget=function(){if($.gameTime>this.lastShot+this.laser.coolDown){var t=Math.atan2(this.potentialTargets[0].y-this.y,this.potentialTargets[0].x-this.x),e={x:this.x,y:this.y};e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.velocity.x,velY:this.velocity.y,faction:this.faction},$.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime}},$.Universe=function(){},$.Universe.init=function(){this.canvas=$.universeCanvas,this.width=6e4,this.height=6e4,this.offsetX=0,this.offsetY=0,this.locations=[],this.ships=[],this.objects=[],this.starLayerWidth=$.screenW,this.starLayerHeight=$.screenH,this.starsLayers=[],this.spawnLocations(13),this.maxPirateShips=12,this.pirateShipCount=0,this.createStars()},$.Universe.spawnLocations=function(t){for(var e=this.width/t*2;t;){var i=Math.floor(Math.random()*$.Universe.width),s=Math.floor(Math.random()*$.Universe.height);if(checkSpacing(i,s,this.locations,e)){var a=new $.Location;a.init(i,s),this.locations.push(a),t--}}},$.Universe.spawnShips=function(){if(this.pirateShipCount<this.maxPirateShips){var t=new $.PirateShip;t.init(),this.ships.push(t),this.pirateShipCount++}},$.Universe.spawnAsteroids=function(){},$.Universe.createStars=function(){function t(t){for(var e=[],i=0;100>i;i++)e.push({radius:1,brightness:getRandomNumFloat(.1,1),x:getRandomNum(0,$.Universe.starLayerWidth),y:getRandomNum(0,$.Universe.starLayerHeight),depth:getRandomNum(1,10)});return e}for(var e=0;3>e;e++)this.starsLayers.push(t(e))},$.Universe.paintStars=function(){for(var t=this.starsLayers.length;t--;)for(var e=this.starsLayers[t].length;e--;){this.starsLayers[t][e].x<0&&(this.starsLayers[t][e].x+=$.screenW),this.starsLayers[t][e].x>$.screenW&&(this.starsLayers[t][e].x-=$.screenW),this.starsLayers[t][e].y<0&&(this.starsLayers[t][e].y+=$.screenH),this.starsLayers[t][e].y>$.screenH&&(this.starsLayers[t][e].y-=$.screenH);var i=this.starsLayers[t][e].x-=$.Player.velocity.x/(20*this.starsLayers[t][e].depth),s=this.starsLayers[t][e].y-=$.Player.velocity.y/(20*this.starsLayers[t][e].depth),a=this.starsLayers[t][e].radius,n=this.starsLayers[t][e].brightness;
this.canvas.beginPath(),this.canvas.rect(i,s,a,a),this.canvas.fillStyle="rgba(255,255,255,"+n+")",this.canvas.fill()}},$.Universe.update=function(){this.offsetX=-($.Player.x-$.screenW/2),this.offsetY=-($.Player.y-$.screenH/2);for(var t=0;t<this.locations.length;t++)this.locations[t].update();for(var e=0;e<this.ships.length;e++)this.ships[e].update();this.draw()},$.Universe.casualUpdate=function(){for(var t=0;t<this.ships.length;t++)this.ships[t].casualUpdate();for(var e=0;e<this.locations.length;e++)this.locations[e].casualUpdate();this.spawnShips()},$.Universe.draw=function(){this.canvas.clearRect(0,0,$.screenW,$.screenH),$.Universe.paintStars()},$.Upgrades={hull:{currentLevel:0,description:"The fragile material separating you and the void.",levels:{level1:{total:500,price:500},level2:{total:750,price:1e3},level3:{total:1e3,price:1500},level4:{total:1250,price:2e3},level5:{total:1500,price:2500}}},shield:{currentLevel:0,description:"Your first layer of defence.",levels:{level1:{total:500,price:500,regenerationRate:.2},level2:{total:750,price:1e3,regenerationRate:.3},level3:{total:1e3,price:1500,regenerationRate:.5},level4:{total:1250,price:2e3,regenerationRate:.7},level5:{total:1500,price:2500,regenerationRate:1}}},engine:{currentLevel:0,description:"Increase top speed, ACCELERATION & fuel capacity",levels:{level1:{topSpeed:7,acceleration:.04,price:500},level2:{topSpeed:8,acceleration:.05,total:750,price:1e3},level3:{topSpeed:9,acceleration:.06,total:1e3,price:1500},level4:{topSpeed:10,acceleration:.07,total:1250,price:2e3},level5:{topSpeed:13,acceleration:.1,total:1500,price:2500}}},laser:{currentLevel:0,description:"Everyone could do with a more powerful laser",levels:{level1:{coolDown:4,hp:25,speed:9,width:40,height:2,price:500},level2:{coolDown:3,hp:35,speed:10,width:50,height:3,price:1e3},level3:{coolDown:2,hp:50,speed:10,width:80,height:4,price:1500},level4:{coolDown:2,hp:70,speed:13,width:90,height:5,price:2e3},level5:{coolDown:1,hp:90,speed:15,width:120,height:6,price:2500}}},radar:{currentLevel:0,description:"The sooner you can spot trouble, the better.",levels:{level1:{radius:6e3,price:500},level2:{radius:9e3,price:1e3},level3:{radius:15e3,price:1500},level4:{radius:2e4,price:2e3},level5:{radius:35e3,price:2500}}}},$.UI=function(){},$.UI.init=function(){var t=document.getElementById("ship-map");this.mapCanvas=t.getContext("2d"),this.mapCanvas.imageSmoothingEnabled=!0,this.playerPos={x:0,y:0},this.messageIsOpen=!1,this.stationMenuIsOpen=!1},$.UI.plotMap=function(){var t=document.getElementById("ship-map").offsetWidth,e=$.Universe.width/t;this.playerPos.x=$.Player.x/e,this.playerPos.y=$.Player.y/e,this.mapCanvas.clearRect(0,0,t,t);for(var i=0;i<$.Universe.locations.length;i++)if($.Universe.locations[i].discovered||getDistance($.Player.x,$.Player.y,$.Universe.locations[i].x,$.Universe.locations[i].y)<=$.Player.radarRadius){$.Universe.locations[i].discovered=!0;var s=$.Universe.locations[i].x/e,a=$.Universe.locations[i].y/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(s,a,3,0,2*Math.PI,!1),this.mapCanvas.fillStyle="#fff",this.mapCanvas.fill()}for(var i=0;i<$.Universe.ships.length;i++)if(!$.Universe.ships[i].atHome&&getDistance($.Player.x,$.Player.y,$.Universe.ships[i].x,$.Universe.ships[i].y)<=$.Player.radarRadius){var s=$.Universe.ships[i].x/e,a=$.Universe.ships[i].y/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(s,a,2,0,2*Math.PI,!1),"outlaw"===$.Universe.ships[i].faction?this.mapCanvas.fillStyle="#fa2444":"police"===$.Universe.ships[i].type?this.mapCanvas.fillStyle="#24cdeb":this.mapCanvas.fillStyle="#a2a2a7",this.mapCanvas.fill()}var n=$.Player.radarRadius/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(this.playerPos.x,this.playerPos.y,n,0,n*Math.PI,!1),this.mapCanvas.fillStyle="rgba(79, 253, 138,0.1)",this.mapCanvas.fill(),this.mapCanvas.beginPath(),this.mapCanvas.arc(this.playerPos.x,this.playerPos.y,2,0,2*Math.PI,!1),this.mapCanvas.fillStyle="#4FFD8A",this.mapCanvas.fill()},$.UI.statusBars=function(){var t=$.Player.fuel.total/$.Player.fuel.capacity*100;document.querySelector(".fuel .bar .remaining").style.width=t+"%";var e=$.Player.shield.total/$.Player.shield.capacity*100;document.querySelector(".shields .bar .remaining").style.width=e+"%";var i=$.Player.hull.total/$.Player.shield.capacity*100;document.querySelector(".hull .bar .remaining").style.width=i+"%"},$.UI.showMessage=function(t){if(!this.messageIsOpen){var e=document.getElementById("message");e.innerHTML=t,e.className="open",this.messageIsOpen=!0}},$.UI.closeMessage=function(){if(this.messageIsOpen){var t=document.getElementById("message");t.innerHTML="",t.className="",this.messageIsOpen=!1}},$.UI.handleTabs=function(t){for(var e=document.querySelectorAll(".tab"),i=e.length;i--;)e[i].className="tab";for(var s=document.querySelectorAll(".warez"),a=s.length;a--;)s[a].className="warez";document.getElementById(t+"Tab").className="tab active",document.getElementById(t).className="warez active"},$.UI.showStationMenu=function(t){this.closeMessage(),this.stationMenuIsOpen=!0;var e=document.getElementById("station-menu"),i=e.getElementsByClassName("station-title")[0];i.innerHTML=t.name,document.getElementById("credits").innerHTML=$.Player.credits.toFixed(2),this.render(),e.className="game-menu open",this.messageIsOpen=!1},$.UI.render=function(){this.renderMarketTable(),this.renderInventoryTable(),this.renderServices(),this.renderUpgrades()},$.UI.renderMarketTable=function(){var t=$.Player.closestStation,e=document.getElementById("market_stock");e.innerHTML="";for(var i in t.stock){var s=e.rows.length,a=e.insertRow(s);a.className=i.replace(/\\/g,"");var n="";n=$.Player.credits>=t.stock[i].price&&t.stock[i].qnt>0?'class="button" onclick="$.UI.buyItem(\''+i+"')\"":'class="button disable"',a.insertCell(0).innerHTML=t.stock[i].qnt,a.insertCell(1).innerHTML=i,a.insertCell(2).innerHTML=t.stock[i].description,a.insertCell(3).innerHTML=t.stock[i].price+'<span class="lwrC">c</span>',a.insertCell(4).innerHTML="<button "+n+">BUY</button>"}},$.UI.renderInventoryTable=function(){var t=$.Player.closestStation,e=document.getElementById("cargobay");e.innerHTML="";for(var i in $.Player.cargoBay){var s=e.rows.length,a=e.insertRow(s);a.className=i.replace(/\\/g,"");var n="",r=0;$.Player.cargoBay[i].qnt>0?(r=t.stock[i].price-$.Player.cargoBay[i].avgPrice,n='class="button" onclick="$.UI.sellItem(\''+i+"')\""):n='class="button disable"',a.insertCell(0).innerHTML=$.Player.cargoBay[i].qnt,a.insertCell(1).innerHTML=i,a.insertCell(2).innerHTML=$.Player.cargoBay[i].netValue+'<span class="lwrC">c<span></span>',a.insertCell(3).innerHTML=t.stock[i].price+'<span class="lwrC">c<span></span>',a.insertCell(4).innerHTML=r.toFixed(2)+'<span class="lwrC">c<span></span>',a.insertCell(5).innerHTML="<button "+n+'">SELL</button>'}},$.UI.renderServices=function(){document.querySelector("#hull .amount").innerHTML=0,document.querySelector("#fuel .amount").innerHTML=0;var t=document.getElementById("hull_slider");t.setAttribute("max",0);var e=$.Player.hull.capacity-$.Player.hull.total,i=$.Player.credits/1;e>i&&(e=i),e>=1?(t.setAttribute("max",e),t.removeAttribute("disabled"),document.querySelector("#hull .button").className="button"):(t.setAttribute("disabled","true"),document.querySelector("#hull .button").className="button disable");var s=document.getElementById("fuel_slider");s.setAttribute("max",0);var a=$.Player.fuel.capacity-$.Player.fuel.total,n=$.Player.credits/.3;a>n&&(a=n),a>=1?(s.setAttribute("max",a),s.removeAttribute("disabled"),document.querySelector("#fuel .button").className="button"):(s.setAttribute("disabled","true"),document.querySelector("#fuel .button").className="button disable")},$.UI.renderUpgrades=function(){document.getElementById("credits").innerHTML=$.Player.credits.toFixed(2);var t=document.getElementById("upgrades_table");t.innerHTML="";for(var e in $.Upgrades){for(var i=t.rows.length,s=t.insertRow(i),a="",n=$.Upgrades[e].currentLevel,r=$.Upgrades[e].levels["level"+(n+1)].price,o="",h=1;5>=h;h++)o+=h>n?'<div class="level"></div>':'<div class="level acquired"></div>';a=$.Player.credits>=r?'class="button" onclick="$.UI.buyUpgrade(\''+e+"')\"":'class="button disable"',s.insertCell(0).innerHTML=e,s.insertCell(1).innerHTML=$.Upgrades[e].description,s.insertCell(2).innerHTML=o,s.insertCell(3).innerHTML=r+'<span class="lwrC">c</span>',s.insertCell(4).innerHTML="<button "+a+">BUY</button>"}},$.UI.buyUpgrade=function(t){$.Upgrades[t].currentLevel++;var e=$.Upgrades[t].currentLevel,i=$.Upgrades[t].levels["level"+e].price,s=$.Upgrades[t].levels["level"+e];("hull"===t||"shield"===t)&&($.Player[t].capacity=s.total,$.Player[t].total=s.total),"shield"===t&&($.Player[t].regenerationRate=s.regenerationRate),"engine"===t&&($.Player.topSpeed=s.topSpeed,$.Player.acceleration=s.acceleration),"laser"===t&&($.Player.laser.coolDown=s.coolDown,$.Player.laser.hp=s.hp,$.Player.laser.speed=s.speed,$.Player.laser.width=s.width,$.Player.laser.height=s.height),"radar"===t&&(this.radarRadius=s.radius),$.Player.credits-=i,this.render()},$.UI.buyItem=function(t){$.Player.closestStation.buyItem(t,$.Player),document.getElementById("credits").innerHTML=$.Player.credits.toFixed(2),this.render()},$.UI.sellItem=function(t){$.Player.closestStation.sellItem(t,$.Player),document.getElementById("credits").innerHTML=$.Player.credits.toFixed(2),this.render()},$.UI.buyService=function(t){var e=document.getElementById(t+"_slider").value;$.Player.closestStation.buyService(t,$.Player,e),document.getElementById("credits").innerHTML=$.Player.credits.toFixed(2),this.render()},$.UI.servicesRange=function(t){var e=document.getElementById(t+"_slider").value,i=$.Player.closestStation.services[t].cost,s=(e*i).toFixed(2)+'<span class="lwrC">c</span>';document.querySelector("#"+t+" .amount").innerHTML=s},$.UI.closeStationMenu=function(){this.stationMenuIsOpen=!1;var t=document.getElementById("station-menu");t.className="game-menu";var e=document.getElementById("market_stock");e.innerHTML="",$.Player.undock()},$.UI.startGame=function(){$.paused=!1,document.getElementById("start-screen").className="game-menu"},$.UI.hit=function(){var t=document.getElementById("game-container");t.className="canvas-wrap shake",setTimeout(function(){t.className="canvas-wrap"},50)},$.UI.update=function(){this.plotMap(),$.UI.statusBars()},$.init=function(){function t(){$.paused||($.render(),$.update()),requestAnimationFrame(t)}this.resizeElements();var e=document.getElementById("player"),i=document.getElementById("objects"),s=document.getElementById("ships"),a=document.getElementById("particles"),n=document.getElementById("projectiles"),r=document.getElementById("universe");$.playerCanvas=e.getContext("2d"),$.playerCanvas.imageSmoothingEnabled=!0,$.universeCanvas=r.getContext("2d"),$.universeCanvas.imageSmoothingEnabled=!0,$.objectsCanvas=i.getContext("2d"),$.objectsCanvas.imageSmoothingEnabled=!0,$.shipsCanvas=s.getContext("2d"),$.shipsCanvas.imageSmoothingEnabled=!0,$.particlesCanvas=a.getContext("2d"),$.particlesCanvas.imageSmoothingEnabled=!0,$.projectilesCanvas=n.getContext("2d"),$.projectilesCanvas.imageSmoothingEnabled=!0,$.gameTime=0,$.renderTime=0,$.score=0,$.paused=!0,$.particleInstances=[],$.KM.init(),$.Universe.init(),$.Player.init(),$.Projectiles.init(),$.UI.init();this.fps=0,t(),setInterval(function(){$.paused||$.casualUpdate()},100)},$.resizeElements=function(){$.screenW=document.getElementById("game-container").offsetWidth,$.screenH=document.getElementById("game-container").offsetHeight;for(var t=document.querySelectorAll(".canvas_layer.main"),e=t.length;e--;)t[e].width=$.screenW,t[e].height=$.screenH},$.casualUpdate=function(){this.gameTime++,$.Player.casualUpdate(),$.UI.update(),$.Universe.casualUpdate()},$.update=function(){$.Player.update(),$.Universe.update(),$.Projectiles.update()},$.render=function(){$.playerCanvas.clearRect(0,0,this.screenW,this.screenH),$.objectsCanvas.clearRect(0,0,this.screenW,this.screenH),$.shipsCanvas.clearRect(0,0,this.screenW,this.screenH),$.projectilesCanvas.clearRect(0,0,this.screenW,this.screenH);for(var t=this.particleInstances.length;t--;)this.particleInstances[t].update()},$.init();